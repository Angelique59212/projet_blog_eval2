{% extends 'base.html.twig' %}
{% import '_macros/alert.html.twig' as Dialog %}

{% block title %}Home !{% endblock %}

{% block body %}
    {% if app.user %} <h1>{{ Dialog.alert('Bonjour' ~' '~ app.user.email, 'warning') }}</h1>
        {% else%}
            {{  Dialog.alert('Bonjour', 'warning') }}
    {% endif %}

    <header>
        {% if app.user %}
            {% if is_granted('ROLE_AUTHOR') %}
                <a href="{{ path('article_add') }}">Ajouter un nouvel article</a>
            {% endif %}

            <button class="btn btn-primary"><a class="color-text" href="{{ path('app_logout') }}">Se d√©connecter</a></button>

            {% else %}
                <button class="btn btn-primary"><a class="color-text" href="{{ path('app_login') }}">Se connecter</a></button>
                <button class="btn btn-primary"><a class="color-text" href="{{ path('app_register') }}">S'enregistrer</a></button>
        {% endif %}

    </header>

    <div class="container">
        {% if articles is defined %}
            {% for article in articles %}
                {% if article.isPublished %}
                    <h1>{{ article.title }}</h1>
                    <p>{{ article.content }}</p>
                    <p>{{ article.author }}</p>
                    <a href="{{ path('comments_add', {id: article.id}) }}">Ajouter un commentaire</a>
                    {% if is_granted('ROLE_AUTHOR') %}
                        <a href="{{ path('article_edit', {'id': article.id}) }}">Editer</a>
                        <a href="{{ path('article_delete', {'id': article.id}) }}">Supprimer</a>
                    {% endif %}
                    <h1>Commentaires: </h1>
                    {% for comment in article.comments %}
                        <p>{{ comment.content }}</p>
                        <p>{{ comment.user.email }}</p>
                        {% if is_granted('ROLE_MODERATOR') %}
                            <a href="{{ path('comments_edit', {'id': comment.id}) }}">Editer</a>
                            <a href="{{ path('comments_delete', {'id': comment.id}) }}">Supprimer</a>
                        {% endif %}
                    {% endfor %}
                {% endif %}
            {% endfor %}
        {% endif %}

    </div>

{% endblock %}
